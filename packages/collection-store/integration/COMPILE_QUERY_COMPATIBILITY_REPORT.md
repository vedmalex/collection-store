# üéâ –ü–æ–ª–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å compileQuery —Å –æ–±—ã—á–Ω—ã–º–∏ query

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

**‚úÖ 100% —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞!**

### –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–µ —Ç–µ—Å—Ç—ã —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
- **62 —Ç–µ—Å—Ç–∞** - –≤—Å–µ –ø—Ä–æ—à–ª–∏ —É—Å–ø–µ—à–Ω–æ ‚úÖ
- **380 –ø—Ä–æ–≤–µ—Ä–æ–∫** - –≤—Å–µ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ ‚úÖ
- **–í—Å–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã** –ø–æ–∫—Ä—ã—Ç—ã —Ç–µ—Å—Ç–∞–º–∏ ‚úÖ

### –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –±–µ–Ω—á–º–∞—Ä–∫–∞
```
Verification successful. Proceeding with benchmarks.
  baseline: New: 9, Pure: 9 ‚úÖ
  array: New: 2, Pure: 2 ‚úÖ
  bitwise: New: 0, Pure: 0 ‚úÖ
  evaluation: New: 7, Pure: 7 ‚úÖ
```

---

## üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. **RegExp –æ–±—ä–µ–∫—Ç—ã –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª–∏—Å—å –≤ build_query_new**
**–ü—Ä–æ–±–ª–µ–º–∞:** –ó–∞–ø—Ä–æ—Å—ã –≤–∏–¥–∞ `{ name: /^A/i }` –Ω–µ —Ä–∞–±–æ—Ç–∞–ª–∏ –≤ –æ–±—ã—á–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ –∑–∞–ø—Ä–æ—Å–æ–≤.

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ RegExp –æ–±—ä–µ–∫—Ç–æ–≤ –≤ `buildIt_new`:
```typescript
// Handle RegExp objects (implicit $regex match)
if (obj instanceof RegExp) {
  try {
    const op = createOperator('$regex', obj as QueryValue)
    return (fieldValue: any) => {
      // MongoDB behavior: if field value is an array, apply regex to each element
      if (Array.isArray(fieldValue)) {
        return fieldValue.some(item => op.evaluate(item))
      }
      return op.evaluate(fieldValue)
    }
  } catch (e) {
    if (e instanceof QueryOperatorError) throw e
    throw new Error(
      `Error creating RegExp operator: ${e instanceof Error ? e.message : String(e)}`,
    )
  }
}
```

---

## üìã –ü–æ–∫—Ä—ã—Ç—ã–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã

### ‚úÖ –û–ø–µ—Ä–∞—Ç–æ—Ä—ã —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
- `$eq` - —Ä–∞–≤–µ–Ω—Å—Ç–≤–æ
- `$gt` - –±–æ–ª—å—à–µ
- `$gte` - –±–æ–ª—å—à–µ –∏–ª–∏ —Ä–∞–≤–Ω–æ
- `$lt` - –º–µ–Ω—å—à–µ
- `$lte` - –º–µ–Ω—å—à–µ –∏–ª–∏ —Ä–∞–≤–Ω–æ
- `$ne` - –Ω–µ —Ä–∞–≤–Ω–æ
- `$in` - –≤—Ö–æ–¥–∏—Ç –≤ –º–∞—Å—Å–∏–≤
- `$nin` - –Ω–µ –≤—Ö–æ–¥–∏—Ç –≤ –º–∞—Å—Å–∏–≤

### ‚úÖ –õ–æ–≥–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã
- `$and` - –ª–æ–≥–∏—á–µ—Å–∫–æ–µ –ò
- `$or` - –ª–æ–≥–∏—á–µ—Å–∫–æ–µ –ò–õ–ò
- `$not` - –ª–æ–≥–∏—á–µ—Å–∫–æ–µ –ù–ï
- `$nor` - –ª–æ–≥–∏—á–µ—Å–∫–æ–µ –ù–ò

### ‚úÖ –û–ø–µ—Ä–∞—Ç–æ—Ä—ã —ç–ª–µ–º–µ–Ω—Ç–æ–≤
- `$exists` - —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –ø–æ–ª—è
- `$type` - —Ç–∏–ø –ø–æ–ª—è (–≤–∫–ª—é—á–∞—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ç–∏–ø—ã)

### ‚úÖ –û–ø–µ—Ä–∞—Ç–æ—Ä—ã –º–∞—Å—Å–∏–≤–æ–≤
- `$all` - –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç
- `$size` - —Ä–∞–∑–º–µ—Ä –º–∞—Å—Å–∏–≤–∞
- `$elemMatch` - —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —ç–ª–µ–º–µ–Ω—Ç–∞ –º–∞—Å—Å–∏–≤–∞

### ‚úÖ –û–ø–µ—Ä–∞—Ç–æ—Ä—ã –≤—ã—á–∏—Å–ª–µ–Ω–∏–π
- `$mod` - –æ—Å—Ç–∞—Ç–æ–∫ –æ—Ç –¥–µ–ª–µ–Ω–∏—è
- `$regex` - —Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è (—Å—Ç—Ä–æ–∫–∏, –æ–±—ä–µ–∫—Ç—ã, RegExp)
- `$where` - JavaScript —Ñ—É–Ω–∫—Ü–∏–∏ –∏ —Å—Ç—Ä–æ–∫–∏

### ‚úÖ –ë–∏—Ç–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã
- `$bitsAllSet` - –≤—Å–µ –±–∏—Ç—ã —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
- `$bitsAnySet` - –ª—é–±–æ–π –±–∏—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
- `$bitsAllClear` - –≤—Å–µ –±–∏—Ç—ã —Å–±—Ä–æ—à–µ–Ω—ã
- `$bitsAnyClear` - –ª—é–±–æ–π –±–∏—Ç —Å–±—Ä–æ—à–µ–Ω

### ‚úÖ –¢–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫
- `$text` - –ø–æ–∏—Å–∫ –ø–æ —Ç–µ–∫—Å—Ç—É —Å —É—á–µ—Ç–æ–º —Ä–µ–≥–∏—Å—Ç—Ä–∞

---

## üß™ –¢–∏–ø—ã —Ç–µ—Å—Ç–æ–≤

### 1. **–ë–∞–∑–æ–≤—ã–µ –ø–æ–ª—è**
- –°—Ç—Ä–æ–∫–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
- –ß–∏—Å–ª–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
- –ë—É–ª–µ–≤—ã –∑–Ω–∞—á–µ–Ω–∏—è
- Null –∑–Ω–∞—á–µ–Ω–∏—è
- –í–ª–æ–∂–µ–Ω–Ω—ã–µ –ø–æ–ª—è
- –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–æ–ª—è (–Ω–µ—è–≤–Ω—ã–π $and)

### 2. **–°–ª–æ–∂–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã**
- –í–ª–æ–∂–µ–Ω–Ω—ã–µ –ª–æ–≥–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã
- –°–º–µ—à–∞–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã
- –û–ø–µ—Ä–∞—Ü–∏–∏ —Å –º–∞—Å—Å–∏–≤–∞–º–∏
- –ë–∏—Ç–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å regex

### 3. **–ì—Ä–∞–Ω–∏—á–Ω—ã–µ —Å–ª—É—á–∞–∏**
- –ü—É—Å—Ç—ã–µ –∑–∞–ø—Ä–æ—Å—ã
- Undefined –∑–Ω–∞—á–µ–Ω–∏—è
- –í–ª–æ–∂–µ–Ω–Ω—ã–µ undefined –ø–æ–ª—è
- Regex —Å–æ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–º–∏ —Å–∏–º–≤–æ–ª–∞–º–∏
- $in —Å —Å–º–µ—à–∞–Ω–Ω—ã–º–∏ —Ç–∏–ø–∞–º–∏
- –ì–ª—É–±–æ–∫–æ –≤–ª–æ–∂–µ–Ω–Ω—ã–µ –ø–æ–ª—è

---

## üéØ –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–µ—Ä—ã

### –ü—Ä–æ—Å—Ç–æ–π –∑–∞–ø—Ä–æ—Å
```javascript
const query1 = { name: 'Alice', age: 25 }
// –û–±–µ —Å–∏—Å—Ç–µ–º—ã –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã ‚úÖ
```

### –°–ª–æ–∂–Ω—ã–π –∑–∞–ø—Ä–æ—Å
```javascript
const query2 = {
  $and: [
    { status: 'active' },
    {
      $or: [
        { age: { $gte: 30 } },
        { score: { $gt: 85 } }
      ]
    },
    { tags: { $nin: ['intern'] } },
    { 'profile.email': { $regex: '\\.com$' } }
  ]
}
// –û–±–µ —Å–∏—Å—Ç–µ–º—ã –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã ‚úÖ
```

### RegExp –∑–∞–ø—Ä–æ—Å
```javascript
const query3 = { name: /^A/i }
// –¢–µ–ø–µ—Ä—å –æ–±–µ —Å–∏—Å—Ç–µ–º—ã —Ä–∞–±–æ—Ç–∞—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤–æ ‚úÖ
```

---

## üìà –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ–∫–∞–∑–∞–ª–∞:
- **–ò–¥–µ–Ω—Ç–∏—á–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã** –¥–ª—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –∑–∞–ø—Ä–æ—Å–æ–≤
- **–ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞** –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤
- **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å** —Å MongoDB-–ø–æ–¥–æ–±–Ω—ã–º –ø–æ–≤–µ–¥–µ–Ω–∏–µ–º

### –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É:
- ‚úÖ **build_query_new** - —Å—Ç–∞–±–∏–ª—å–Ω–∞—è –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É–µ–º–∞—è –≤–µ—Ä—Å–∏—è
- ‚úÖ **compileQuery** - –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∫–æ–º–ø–∏–ª–∏—Ä—É–µ–º–∞—è –≤–µ—Ä—Å–∏—è
- ‚úÖ **–ë–µ–Ω—á–º–∞—Ä–∫** - –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

---

## üéâ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**compileQuery —Ç–µ–ø–µ—Ä—å –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–≤–º–µ—Å—Ç–∏–º —Å –æ–±—ã—á–Ω—ã–º–∏ query!**

1. **‚úÖ –í—Å–µ 62 —Ç–µ—Å—Ç–∞ –ø—Ä–æ—à–ª–∏** - –ø–æ–ª–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤
2. **‚úÖ –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –±–µ–Ω—á–º–∞—Ä–∫–∞ —É—Å–ø–µ—à–Ω–∞** - –∏–¥–µ–Ω—Ç–∏—á–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
3. **‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ RegExp** - —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å MongoDB
4. **‚úÖ –ì–æ—Ç–æ–≤ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞** - –¥–≤–µ –ø–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

–¢–µ–ø–µ—Ä—å —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏ –º–æ–≥—É—Ç –≤—ã–±–∏—Ä–∞—Ç—å –º–µ–∂–¥—É:
- **query()** - –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã –∏ –æ—Ç–ª–∞–¥–∫–∏
- **compileQuery()** - –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

–û–±–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –∏–¥–µ–Ω—Ç–∏—á–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–ª—è –ª—é–±—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤!