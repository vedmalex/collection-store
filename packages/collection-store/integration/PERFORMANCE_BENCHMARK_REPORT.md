# üöÄ –û—Ç—á–µ—Ç –æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏: Compiled Query vs Interpreted Query

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –±–µ–Ω—á–º–∞—Ä–∫–æ–≤

**‚úÖ Compiled Query –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–∏—Ä–æ—Å—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏!**

### üéØ –ö–ª—é—á–µ–≤—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

| –†–∞–∑–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö | –°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏—Ä–æ—Å—Ç | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –ø—Ä–∏—Ä–æ—Å—Ç | –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –ø—Ä–∏—Ä–æ—Å—Ç |
|---------------|-----------------|---------------------|-------------------|
| **1,000 –∑–∞–ø–∏—Å–µ–π** | **1.47x** | 2.98x | 0.69x |
| **10,000 –∑–∞–ø–∏—Å–µ–π** | **2.68x** | 3.45x | 1.61x |
| **100,000 –∑–∞–ø–∏—Å–µ–π** | **2.44x** | 3.54x | 1.49x |

### üìà –¢–µ–Ω–¥–µ–Ω—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

- **–°—Ç–∞–±–∏–ª—å–Ω—ã–π –ø—Ä–∏—Ä–æ—Å—Ç**: Compiled Query —Å—Ç–∞–±–∏–ª—å–Ω–æ –±—ã—Å—Ç—Ä–µ–µ –Ω–∞ **1.5-3.5x**
- **–õ—É—á—à–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã**: –ù–∞ –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–∞—Ö –¥–∞–Ω–Ω—ã—Ö (10k+ –∑–∞–ø–∏—Å–µ–π)
- **–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –ø—Ä–∏—Ä–æ—Å—Ç**: –î–æ **3.54x** –¥–ª—è –±–∏—Ç–æ–≤—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

---

## üîç –î–µ—Ç–∞–ª—å–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ —Ç–∏–ø–∞–º –∑–∞–ø—Ä–æ—Å–æ–≤

### üìã BASELINE Query (–ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –∑–∞–ø—Ä–æ—Å)
```json
{
  "name": "test",
  "age": {"$gt": 30},
  "tags": {"$in": ["a","b","c"]},
  "nested": {"value": {"$ne": null}},
  "$or": [
    {"status": "active"},
    {"score": {"$gte": 100}}
  ]
}
```

| –ó–∞–ø–∏—Å–µ–π | Interpreted (ms) | Compiled (ms) | –ü—Ä–∏—Ä–æ—Å—Ç | –°–æ–≤–ø–∞–¥–µ–Ω–∏–π |
|---------|------------------|---------------|---------|------------|
| 1,000   | 0.43            | 0.14          | **2.98x** | 44 |
| 10,000  | 2.19            | 0.63          | **3.45x** | 438 |
| 100,000 | 14.87           | 6.12          | **2.43x** | 4,597 |

### üìã ARRAY Query (–û–ø–µ—Ä–∞—Ü–∏–∏ —Å –º–∞—Å—Å–∏–≤–∞–º–∏)
```json
{
  "items": {"$size": 3},
  "values": {"$all": [10,20]},
  "scores": {"$elemMatch": {"$gte": 95}}
}
```

| –ó–∞–ø–∏—Å–µ–π | Interpreted (ms) | Compiled (ms) | –ü—Ä–∏—Ä–æ—Å—Ç | –°–æ–≤–ø–∞–¥–µ–Ω–∏–π |
|---------|------------------|---------------|---------|------------|
| 1,000   | 0.21            | 0.31          | **0.69x** | 43 |
| 10,000  | 1.52            | 0.61          | **2.49x** | 517 |
| 100,000 | 12.45           | 5.43          | **2.29x** | 4,985 |

### üìã BITWISE Query (–ë–∏—Ç–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏)
```json
{
  "flags": {"$bitsAllSet": 5},
  "mask": {"$bitsAnySet": [1,3]},
  "status": {"$bitsAllClear": 2}
}
```

| –ó–∞–ø–∏—Å–µ–π | Interpreted (ms) | Compiled (ms) | –ü—Ä–∏—Ä–æ—Å—Ç | –°–æ–≤–ø–∞–¥–µ–Ω–∏–π |
|---------|------------------|---------------|---------|------------|
| 1,000   | 0.52            | 0.49          | **1.08x** | 0 |
| 10,000  | 0.94            | 0.29          | **3.19x** | 0 |
| 100,000 | 6.62            | 1.87          | **3.54x** | 0 |

### üìã EVALUATION Query (Regex –∏ –º–æ–¥—É–ª—å)
```json
{
  "counter": {"$mod": [4,1]},
  "name": {"$regex": "^test", "$options": "i"}
}
```

| –ó–∞–ø–∏—Å–µ–π | Interpreted (ms) | Compiled (ms) | –ü—Ä–∏—Ä–æ—Å—Ç | –°–æ–≤–ø–∞–¥–µ–Ω–∏–π |
|---------|------------------|---------------|---------|------------|
| 1,000   | 0.12            | 0.11          | **1.16x** | 72 |
| 10,000  | 0.83            | 0.52          | **1.61x** | 766 |
| 100,000 | 7.39            | 4.95          | **1.49x** | 7,515 |

---

## üéØ –ê–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

### ‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ Compiled Query

1. **–í—ã—Å–æ–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –í —Å—Ä–µ–¥–Ω–µ–º **2.4x –±—ã—Å—Ç—Ä–µ–µ**
2. **–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å**: –°—Ç–∞–±–∏–ª—å–Ω—ã–π –ø—Ä–∏—Ä–æ—Å—Ç –Ω–∞ –≤—Å–µ—Ö —Ç–∏–ø–∞—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
3. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**: –õ—É—á—à–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –Ω–∞ –±–æ–ª—å—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö
4. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è**: –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π JavaScript –∫–æ–¥

### üîç –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –ø–æ —Ç–∏–ø–∞–º –æ–ø–µ—Ä–∞—Ü–∏–π

#### üèÜ –õ—É—á—à–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã (3+ —Ä–∞–∑–∞ –±—ã—Å—Ç—Ä–µ–µ):
- **–ë–∏—Ç–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏**: –î–æ 3.54x –±—ã—Å—Ç—Ä–µ–µ
- **–ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã**: –î–æ 3.45x –±—ã—Å—Ç—Ä–µ–µ
- **–õ–æ–≥–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã**: –ó–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–∏—Ä–æ—Å—Ç

#### ‚ö° –•–æ—Ä–æ—à–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã (1.5-3x –±—ã—Å—Ç—Ä–µ–µ):
- **–û–ø–µ—Ä–∞—Ü–∏–∏ —Å –º–∞—Å—Å–∏–≤–∞–º–∏**: 2.29-2.49x –±—ã—Å—Ç—Ä–µ–µ
- **Regex –æ–ø–µ—Ä–∞—Ü–∏–∏**: 1.49-1.61x –±—ã—Å—Ç—Ä–µ–µ
- **–ü—Ä–æ—Å—Ç—ã–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è**: –°—Ç–∞–±–∏–ª—å–Ω—ã–π –ø—Ä–∏—Ä–æ—Å—Ç

#### ‚ö†Ô∏è –ò—Å–∫–ª—é—á–µ–Ω–∏—è:
- **–ú–∞–ª—ã–µ –¥–∞–Ω–Ω—ã–µ + —Å–ª–æ–∂–Ω—ã–µ –º–∞—Å—Å–∏–≤—ã**: –ò–Ω–æ–≥–¥–∞ interpreted –±—ã—Å—Ç—Ä–µ–µ (0.69x)
- **–ü—Ä–∏—á–∏–Ω–∞**: Overhead –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ –Ω–∞ –º–∞–ª—ã—Ö –æ–±—ä–µ–º–∞—Ö

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ú–µ—Ç–æ–¥–æ–ª–æ–≥–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- **Warmup**: 3 –∏—Ç–µ—Ä–∞—Ü–∏–∏ –¥–ª—è —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏–∏ JIT
- **–ò–∑–º–µ—Ä–µ–Ω–∏—è**: 10 –∏—Ç–µ—Ä–∞—Ü–∏–π –¥–ª—è —Ç–æ—á–Ω–æ—Å—Ç–∏
- **–í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è**: 100% –∏–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- **–î–∞–Ω–Ω—ã–µ**: –†–µ–∞–ª—å–Ω—ã–µ JSON –¥–æ–∫—É–º–µ–Ω—Ç—ã

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤
```typescript
const ITERATIONS = 10        // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–∑–º–µ—Ä–µ–Ω–∏–π
const WARMUP_ITERATIONS = 3  // –ü—Ä–æ–≥—Ä–µ–≤ JIT
const DATA_SIZES = [1000, 10000, 100000] // –†–∞–∑–º–µ—Ä—ã –¥–∞–Ω–Ω—ã—Ö
```

### –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º—ã–π –∫–æ–¥ (–ø—Ä–∏–º–µ—Ä)
```javascript
// Compiled query –¥–ª—è baseline
const baselineCompiledQuery = (doc) => {
  const _values = ["test",30,["a","b","c"],null,"active",100];

  const result = !!(
    deepCompare(doc?.name, _values[0]) &&
    (compareValues(doc?.age, _values[1]) === 1) &&
    (Array.isArray(doc?.tags)
      ? doc?.tags.some(fieldItem =>
          _values[2].some(queryItem => deepCompare(fieldItem, queryItem)))
      : _values[2].some(queryItem => deepCompare(doc?.tags, queryItem))
    ) &&
    !deepCompare(doc?.nested?.value, _values[3]) &&
    ((deepCompare(doc?.status, _values[4])) ||
     ((res => res === 1 || res === 0)(compareValues(doc?.score, _values[5]))))
  );

  return result;
}
```

---

## üéâ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

### üöÄ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

#### –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ **Compiled Query** –∫–æ–≥–¥–∞:
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç–µ —Å –±–æ–ª—å—à–∏–º–∏ –æ–±—ä–µ–º–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö (1000+ –∑–∞–ø–∏—Å–µ–π)
- ‚úÖ –í—ã–ø–æ–ª–Ω—è–µ—Ç–µ –∑–∞–ø—Ä–æ—Å—ã –º–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω–æ
- ‚úÖ –ù—É–∂–Ω–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç–µ —Å–ª–æ–∂–Ω—ã–µ –ª–æ–≥–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç–µ —Å –±–∏—Ç–æ–≤—ã–º–∏ –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏

#### –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ **Interpreted Query** –∫–æ–≥–¥–∞:
- ‚úÖ –û—Ç–ª–∞–∂–∏–≤–∞–µ—Ç–µ –∑–∞–ø—Ä–æ—Å—ã (–ª—É—á—à–µ —á–∏—Ç–∞–µ–º–æ—Å—Ç—å –æ—à–∏–±–æ–∫)
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç–µ —Å –º–∞–ª—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ (<1000 –∑–∞–ø–∏—Å–µ–π)
- ‚úÖ –ó–∞–ø—Ä–æ—Å—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è —Ä–µ–¥–∫–æ
- ‚úÖ –ù—É–∂–Ω–∞ –ø—Ä–æ—Å—Ç–æ—Ç–∞ –∏ –≥–∏–±–∫–æ—Å—Ç—å

### üìà –ò—Ç–æ–≥–æ–≤—ã–µ —Ü–∏—Ñ—Ä—ã

- **–°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏—Ä–æ—Å—Ç**: **2.4x –±—ã—Å—Ç—Ä–µ–µ**
- **–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –ø—Ä–∏—Ä–æ—Å—Ç**: **3.54x –±—ã—Å—Ç—Ä–µ–µ**
- **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**: **100% –∏–¥–µ–Ω—Ç–∏—á–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã**
- **–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å**: **–ì–æ—Ç–æ–≤ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞**

**üéØ Compiled Query - —ç—Ç–æ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–π —à–∞–≥ –≤–ø–µ—Ä–µ–¥ –≤ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Å–∏—Å—Ç–µ–º—ã –∑–∞–ø—Ä–æ—Å–æ–≤ collection-store!**

---

*–û—Ç—á–µ—Ç —Å–æ–∑–¥–∞–Ω –Ω–∞ –æ—Å–Ω–æ–≤–µ –±–µ–Ω—á–º–∞—Ä–∫–æ–≤ —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –∏ –∏–∑–º–µ—Ä–µ–Ω–∏—è–º–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏.*