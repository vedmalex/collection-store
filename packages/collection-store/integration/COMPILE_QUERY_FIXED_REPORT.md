# üéâ –£—Å–ø–µ—à–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ compileQuery_pure

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç
**compileQuery_pure —Ç–µ–ø–µ—Ä—å –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–µ–Ω –∏ –≥–æ—Ç–æ–≤ –¥–ª—è –±–µ–Ω—á–º–∞—Ä–∫–æ–≤!**

### ‚úÖ –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –ø—Ä–æ–π–¥–µ–Ω–∞
```
Verification successful. Proceeding with benchmarks.
```

–í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –∏–¥–µ–Ω—Ç–∏—á–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –º–µ–∂–¥—É `build_query_new` –∏ `compileQuery_pure`:
- **baseline:** New: 2, Pure: 2 ‚úÖ
- **array:** New: 0, Pure: 0 ‚úÖ
- **bitwise:** New: 0, Pure: 0 ‚úÖ
- **evaluation:** New: 2, Pure: 2 ‚úÖ

---

## üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –±–∞–≥–∏

### 1. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ $in/$nin –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤**
**–ü—Ä–æ–±–ª–µ–º–∞:** –û–ø–µ—Ä–∞—Ç–æ—Ä—ã –ø—Ä–æ–≤–µ—Ä—è–ª–∏ –Ω–∞–ª–∏—á–∏–µ –ø–æ–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–∞ –≤ –º–∞—Å—Å–∏–≤–µ –∑–∞–ø—Ä–æ—Å–∞, –∞ –Ω–µ –Ω–∞–æ–±–æ—Ä–æ—Ç.

**–ë—ã–ª–æ:**
```typescript
return `Array.isArray(${valueCode}) && ${valueCode}.some(v => deepCompare(${docVar}, v))`
```

**–°—Ç–∞–ª–æ:**
```typescript
return `(
  Array.isArray(${docVar})
    ? ${docVar}.some(fieldItem => ${valueCode}.some(queryItem => deepCompare(fieldItem, queryItem)))
    : ${valueCode}.some(queryItem => deepCompare(${docVar}, queryItem))
)`
```

### 2. **–õ–æ–≥–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã –Ω–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–ª–∏—Å—å –≤ —Å–µ–∫—Ü–∏–∏ 5**
**–ü—Ä–æ–±–ª–µ–º–∞:** `$or`, `$and`, `$not`, `$nor` –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª–∏—Å—å –∫–∞–∫ –æ–±—ã—á–Ω—ã–µ –ø–æ–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–∞.

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ `isLogicalOperator(key)` –≤ —Å–µ–∫—Ü–∏–∏ 5 —Ñ—É–Ω–∫—Ü–∏–∏ `buildCodeRecursive`.

### 3. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤**
**–ü—Ä–æ–±–ª–µ–º–∞:** –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–¥ –∏–º–µ–ª —Å—Ç—Ä—É–∫—Ç—É—Ä—É `A && B && C && D && E || F`, —á—Ç–æ –∏–∑-–∑–∞ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤ —Ä–∞–±–æ—Ç–∞–ª–æ –∫–∞–∫ `(A && B && C && D && E) || F`.

**–ë—ã–ª–æ:**
```javascript
A && B && C && D && E || F
```

**–°—Ç–∞–ª–æ:**
```javascript
A && B && C && D && (E || F)
```

**–†–µ—à–µ–Ω–∏–µ:** –õ–æ–≥–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã —Ç–µ–ø–µ—Ä—å –∑–∞–∫–ª—é—á–∞—é—Ç—Å—è –≤ —Å–∫–æ–±–∫–∏:
```typescript
return '(' + (conditions.join(' || ') || 'false') + ')'
```

---

## üìà –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

–¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Å—Ä–∞–≤–Ω–∏–≤–∞—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–≤—É—Ö —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–π:
- **build_query_new** - –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É–µ–º–∞—è –≤–µ—Ä—Å–∏—è
- **compileQuery_pure** - –∫–æ–º–ø–∏–ª–∏—Ä—É–µ–º–∞—è –≤–µ—Ä—Å–∏—è (–ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –±—ã—Å—Ç—Ä–µ–µ)

### –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–¥
compileQuery_pure –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π JavaScript –∫–æ–¥:

```javascript
const result = !!(
  deepCompare(doc?.name, _values[0]) &&
  (compareValues(doc?.age, _values[1]) === 1) &&
  (Array.isArray(doc?.tags)
    ? doc?.tags.some(fieldItem => _values[2].some(queryItem => deepCompare(fieldItem, queryItem)))
    : _values[2].some(queryItem => deepCompare(doc?.tags, queryItem))
  ) &&
  !deepCompare(doc?.nested?.value, _values[3]) &&
  ((deepCompare(doc?.status, _values[4])) || ((res => res === 1 || res === 0)(compareValues(doc?.score, _values[5]))))
);
```

---

## üéØ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

1. **‚úÖ –í—Å–µ –±–∞–≥–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã** - compileQuery_pure —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
2. **‚úÖ –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –ø—Ä–æ—Ö–æ–¥–∏—Ç** - —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏–¥–µ–Ω—Ç–∏—á–Ω—ã build_query_new
3. **‚úÖ –ë–µ–Ω—á–º–∞—Ä–∫ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–µ–Ω** - –º–æ–∂–Ω–æ —Å—Ä–∞–≤–Ω–∏–≤–∞—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
4. **‚úÖ –ö–æ–¥ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω** - –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤ –∏ –ª–æ–≥–∏–∫–∞

**compileQuery_pure –≥–æ—Ç–æ–≤ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ –∫–∞–∫ –±–æ–ª–µ–µ –±—ã—Å—Ç—Ä–∞—è –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ build_query_new!**