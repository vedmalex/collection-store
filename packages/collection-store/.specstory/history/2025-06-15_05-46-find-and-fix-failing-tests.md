<!-- Generated by SpecStory -->

# Find and fix failing tests (2025-06-15 08:46:36)

_**User**_

@test_output.log - файл с результатами тестов
нужно с помощью grep найти падающие тесты и начать исправление этих файлов по одному используя bun test <название файла>

---

_**Assistant**_

Я помогу найти падающие тесты и начать их исправление. Сначала проанализируем файл с результатами тестов, чтобы найти все падающие тесты.

---

<details>
            <summary>Grep search for "FAIL|✗|Error:|Failed" • **4** files</summary>
        
| File | Line | Match |
|------|------|-------|
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/test_system_failures_fix.log` | L79 | `"failedOperations": 10` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/test_system_failures_fix.log` | L201 | `"failedOperations": 10` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/test_system_failures_fix.log` | L252 | `(skip) TransactionManager > Transaction Rollback > should rollback when prepare fails` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/test_system_failures_fix.log` | L258 | `(skip) TransactionManager > Error Handling > should handle commit failure gracefully` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/test_system_failures_fix.log` | L259 | `(skip) TransactionManager > Error Handling > should handle rollback failure gracefully` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/test_system_failures_fix.log` | L279 | `(skip) Raft Leader Election > Error Handling > should handle RPC failures gracefully` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/test_system_failures_fix.log` | L295 | `(skip) Replication WAL Streaming Integration > Error Handling > should handle replication failures gracefully` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/test_system_failures_fix.log` | L460 | `(skip) TransactionalCollection > 2PC Protocol > should handle prepare failure gracefully` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/test_system_failures_fix.log` | L541 | `(skip) WAL Transaction Coordination > Storage Adapter Integration > should handle adapter prepare failure` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/test_system_failures_fix.log` | L639 | `(skip) Raft Log Replication > Leader Replication > should handle replication failures` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/test_system_failures_fix.log` | L736 | `(skip) Replication Network Layer > Basic Network Operations > should handle connection failures gracefully` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/test_system_failures_fix.log` | L745 | `(skip) Replication Network Layer > Error Handling > should recover from connection failures` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/test_system_failures_fix.log` | L811 | `(skip) Raft Network Layer > Retry Mechanism > should retry failed requests with exponential backoff` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/test_system_failures_fix.log` | L824 | `(skip) Raft Network Layer > Error Handling > should emit appropriate events on failures` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/test_system_failures_fix.log` | L1025 | `(skip) AuditLogger > Specialized Query Methods > should get failed attempts` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/test_system_failures_fix.log` | L1092 | `(skip) CompressionEngine > Error Handling > should emit error events on failure` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/test_system_failures_fix.log` | L1093 | `(skip) CompressionEngine > Error Handling > should track failed jobs in statistics` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/test_system_failures_fix.log` | L1108 | `(skip) File Storage Component Integration > Error Handling Integration > should handle component failures gracefully` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/test_system_failures_fix.log` | L1109 | `(skip) File Storage Component Integration > Error Handling Integration > should maintain system stability during failures` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/test_system_failures_fix.log` | L1112 | `(skip) File Storage Component Integration > Health Monitoring Integration > should handle health check failures gracefully` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/test_system_failures_fix.log` | L1122 | `(skip) ThumbnailGenerator > Single Thumbnail Generation > should throw error when generation fails` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/test_system_failures_fix.log` | L1125 | `(skip) ThumbnailGenerator > Multiple Thumbnail Generation > should handle partial failures gracefully` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/test_system_failures_fix.log` | L1142 | `(skip) ThumbnailGenerator > Event Emission > should emit job failed event on error` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/test_system_failures_fix.log` | L1283 | `(skip) FileReplicationManager > File Synchronization > should handle sync failures gracefully` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/test_system_failures_fix.log` | L1292 | `(skip) FileReplicationManager > Error Handling > should handle replication failures with retry` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/test_system_failures_fix.log` | L1293 | `(skip) FileReplicationManager > Error Handling > should emit replication failed events` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/test_system_failures_fix.log` | L1306 | `(skip) FileStoragePerformanceMonitor > Operation Measurement > should measure failed operations` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/test_system_failures_fix.log` | L1450 | `(skip) DataFilter > Multiple Filters > should reject if any filter fails` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/test_system_failures_fix.log` | L1465 | `(skip) SubscriptionEngine > Subscription Management > should fail to create subscription when engine is not running` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/test_system_failures_fix.log` | L1467 | `(skip) SubscriptionEngine > Subscription Management > should fail to unsubscribe non-existent subscription` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/test_system_failures_fix.log` | L1559 | `(skip) ClientSubscriptionManager > Error Handling > should handle sync failures gracefully` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/test_system_failures_fix.log` | L1581 | `(skip) Subscription System Integration > End-to-End Subscription Flow > should handle authentication failures gracefully` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/test_system_failures_fix.log` | L1582 | `(skip) Subscription System Integration > End-to-End Subscription Flow > should handle connection failures gracefully` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/test_system_failures_fix.log` | L1585 | `(skip) Subscription System Integration > Error Recovery > should recover from notification failures` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/test_system_failures_fix.log` | L1790 | `(skip) RealTimeOptimizer > Error Handling > should handle action execution failures` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/test_system_failures_fix.log` | L1805 | `(skip) AutomatedOptimizationEngine > Optimization Execution > should handle optimization failures gracefully` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/test_system_failures_fix.log` | L1814 | `(skip) AutomatedOptimizationEngine > Validation and Rollback > should handle rollback failures gracefully` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/test_system_failures_fix.log` | L1835 | `(skip) Automated Optimization Integration > Error Handling and Recovery > should handle validation failures gracefully` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/test_system_failures_fix.log` | L1836 | `(pass) Automated Optimization Integration > Error Handling and Recovery > should handle system failures and recovery [247.23ms]` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/test_system_failures_fix.log` | L1837 | `(skip) Automated Optimization Integration > Error Handling and Recovery > should maintain audit trail during failures` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/test_system_failures_fix.log` | L1905 | `(skip) Phase 6: LoadTestManager > Success Criteria Evaluation > should fail test when response time exceeds threshold` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/test_system_failures_fix.log` | L1906 | `(skip) Phase 6: LoadTestManager > Success Criteria Evaluation > should provide detailed failure reasons` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/test_system_failures_fix.log` | L2493 | `(skip) Day 6 Cache Invalidator Implementation > CacheInvalidator > Metrics and Monitoring > should track failed invalidations` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/test_system_failures_fix.log` | L2499 | `(skip) Day 6 Cache Invalidator Implementation > CacheInvalidator > Event Handling > should emit error events for cascading failures` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/test_system_failures_fix.log` | L2664 | `(skip) PolicyEvaluator > Health Check > should fail health check with invalid configuration` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/test_system_failures_fix.log` | L2844 | `(skip) SessionManager > recoverSession > should fail to recover non-existent session` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/test_system_failures_fix.log` | L2923 | `0 fail` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/test_rollback_fix.log` | L79 | `"failedOperations": 10` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/test_rollback_fix.log` | L201 | `"failedOperations": 10` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/test_rollback_fix.log` | L252 | `(skip) TransactionManager > Transaction Rollback > should rollback when prepare fails` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/test_rollback_fix.log` | L258 | `(skip) TransactionManager > Error Handling > should handle commit failure gracefully` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/test_rollback_fix.log` | L259 | `(skip) TransactionManager > Error Handling > should handle rollback failure gracefully` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/test_rollback_fix.log` | L279 | `(skip) Raft Leader Election > Error Handling > should handle RPC failures gracefully` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/test_rollback_fix.log` | L295 | `(skip) Replication WAL Streaming Integration > Error Handling > should handle replication failures gracefully` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/test_rollback_fix.log` | L460 | `(skip) TransactionalCollection > 2PC Protocol > should handle prepare failure gracefully` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/test_rollback_fix.log` | L541 | `(skip) WAL Transaction Coordination > Storage Adapter Integration > should handle adapter prepare failure` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/test_rollback_fix.log` | L639 | `(skip) Raft Log Replication > Leader Replication > should handle replication failures` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/test_rollback_fix.log` | L736 | `(skip) Replication Network Layer > Basic Network Operations > should handle connection failures gracefully` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/test_rollback_fix.log` | L745 | `(skip) Replication Network Layer > Error Handling > should recover from connection failures` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/test_rollback_fix.log` | L811 | `(skip) Raft Network Layer > Retry Mechanism > should retry failed requests with exponential backoff` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/test_rollback_fix.log` | L824 | `(skip) Raft Network Layer > Error Handling > should emit appropriate events on failures` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/test_rollback_fix.log` | L1025 | `(skip) AuditLogger > Specialized Query Methods > should get failed attempts` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/test_rollback_fix.log` | L1092 | `(skip) CompressionEngine > Error Handling > should emit error events on failure` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/test_rollback_fix.log` | L1093 | `(skip) CompressionEngine > Error Handling > should track failed jobs in statistics` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/test_rollback_fix.log` | L1108 | `(skip) File Storage Component Integration > Error Handling Integration > should handle component failures gracefully` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/test_rollback_fix.log` | L1109 | `(skip) File Storage Component Integration > Error Handling Integration > should maintain system stability during failures` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/test_rollback_fix.log` | L1112 | `(skip) File Storage Component Integration > Health Monitoring Integration > should handle health check failures gracefully` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/test_rollback_fix.log` | L1122 | `(skip) ThumbnailGenerator > Single Thumbnail Generation > should throw error when generation fails` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/test_rollback_fix.log` | L1125 | `(skip) ThumbnailGenerator > Multiple Thumbnail Generation > should handle partial failures gracefully` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/test_rollback_fix.log` | L1142 | `(skip) ThumbnailGenerator > Event Emission > should emit job failed event on error` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/test_rollback_fix.log` | L1283 | `(skip) FileReplicationManager > File Synchronization > should handle sync failures gracefully` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/test_rollback_fix.log` | L1292 | `(skip) FileReplicationManager > Error Handling > should handle replication failures with retry` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/test_rollback_fix.log` | L1293 | `(skip) FileReplicationManager > Error Handling > should emit replication failed events` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/test_rollback_fix.log` | L1306 | `(skip) FileStoragePerformanceMonitor > Operation Measurement > should measure failed operations` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/test_rollback_fix.log` | L1450 | `(skip) DataFilter > Multiple Filters > should reject if any filter fails` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/test_rollback_fix.log` | L1465 | `(skip) SubscriptionEngine > Subscription Management > should fail to create subscription when engine is not running` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/test_rollback_fix.log` | L1467 | `(skip) SubscriptionEngine > Subscription Management > should fail to unsubscribe non-existent subscription` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/test_rollback_fix.log` | L1559 | `(skip) ClientSubscriptionManager > Error Handling > should handle sync failures gracefully` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/test_rollback_fix.log` | L1581 | `(skip) Subscription System Integration > End-to-End Subscription Flow > should handle authentication failures gracefully` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/test_rollback_fix.log` | L1582 | `(skip) Subscription System Integration > End-to-End Subscription Flow > should handle connection failures gracefully` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/test_rollback_fix.log` | L1585 | `(skip) Subscription System Integration > Error Recovery > should recover from notification failures` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/test_rollback_fix.log` | L1790 | `(skip) RealTimeOptimizer > Error Handling > should handle action execution failures` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/test_rollback_fix.log` | L1805 | `(skip) AutomatedOptimizationEngine > Optimization Execution > should handle optimization failures gracefully` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/test_rollback_fix.log` | L1814 | `(skip) AutomatedOptimizationEngine > Validation and Rollback > should handle rollback failures gracefully` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/test_rollback_fix.log` | L1835 | `(skip) Automated Optimization Integration > Error Handling and Recovery > should handle validation failures gracefully` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/test_rollback_fix.log` | L1836 | `(skip) Automated Optimization Integration > Error Handling and Recovery > should handle system failures and recovery` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/test_rollback_fix.log` | L1837 | `(skip) Automated Optimization Integration > Error Handling and Recovery > should maintain audit trail during failures` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/test_rollback_fix.log` | L1905 | `(skip) Phase 6: LoadTestManager > Success Criteria Evaluation > should fail test when response time exceeds threshold` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/test_rollback_fix.log` | L1906 | `(skip) Phase 6: LoadTestManager > Success Criteria Evaluation > should provide detailed failure reasons` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/test_rollback_fix.log` | L2493 | `(skip) Day 6 Cache Invalidator Implementation > CacheInvalidator > Metrics and Monitoring > should track failed invalidations` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/test_rollback_fix.log` | L2499 | `(skip) Day 6 Cache Invalidator Implementation > CacheInvalidator > Event Handling > should emit error events for cascading failures` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/test_rollback_fix.log` | L2664 | `(skip) PolicyEvaluator > Health Check > should fail health check with invalid configuration` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/test_rollback_fix.log` | L2844 | `(skip) SessionManager > recoverSession > should fail to recover non-existent session` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/test_rollback_fix.log` | L2923 | `0 fail` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/test_results_full.log` | L79 | `"failedOperations": 10` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/test_results_full.log` | L201 | `"failedOperations": 10` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/test_results_full.log` | L252 | `(pass) TransactionManager > Transaction Rollback > should rollback when prepare fails [0.15ms]` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/test_results_full.log` | L258 | `(pass) TransactionManager > Error Handling > should handle commit failure gracefully [0.19ms]` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/test_results_full.log` | L259 | `(pass) TransactionManager > Error Handling > should handle rollback failure gracefully [0.05ms]` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/test_results_full.log` | L279 | `(pass) Raft Leader Election > Error Handling > should handle RPC failures gracefully [0.49ms]` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L65 | `Failed to prepare transaction test-tx-1: 159 |       // Create a scenario that might cause prepare to throw` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L72 | `error: Test error` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L2701 | `(pass) TransactionManager > Transaction Rollback > should rollback when prepare fails [0.14ms]` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L2707 | `(pass) TransactionManager > Error Handling > should handle commit failure gracefully [0.14ms]` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L2708 | `(pass) TransactionManager > Error Handling > should handle rollback failure gracefully [0.12ms]` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L2721 | `(pass) TransactionalCollection > 2PC Protocol > should handle prepare failure gracefully [0.37ms]` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L2753 | `(pass) Raft Leader Election > Error Handling > should handle RPC failures gracefully` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L2764 | `(pass) Raft Log Replication > Leader Replication > should handle replication failures [0.36ms]` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L2910 | `(pass) Raft Network Layer > Retry Mechanism > should retry failed requests with exponential backoff [10.56ms]` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L2923 | `(pass) Raft Network Layer > Error Handling > should emit appropriate events on failures [0.17ms]` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3090 | `(pass) Replication WAL Streaming Integration > Error Handling > should handle replication failures gracefully [1.08ms]` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3257 | `Failed to connect to node node2 (attempt 1): ErrorEvent {` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3259 | `message: "WebSocket connection to 'ws://localhost:8386/?nodeId=node1' failed: Failed to connect",` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3260 | `error: null,` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3263 | `Connection test failed: ErrorEvent {` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3265 | `message: "WebSocket connection to 'ws://localhost:8386/?nodeId=node1' failed: Failed to connect",` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3266 | `error: null,` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3278 | `Failed to connect to node nonexistent (attempt 1): 115 |         this.#createWebSocket(url, protocols, headers, method);` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3285 | `SyntaxError: Invalid url for WebSocket ws://localhost:99999?nodeId=node1` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3294 | `(pass) Replication Network Layer > Basic Network Operations > should handle connection failures gracefully [0.49ms]` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3304 | `Failed to connect to node node2 (attempt 1): ErrorEvent {` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3306 | `message: "WebSocket connection to 'ws://localhost:8279/?nodeId=node1' failed: Failed to connect",` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3307 | `error: null,` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3310 | `Message test failed: ErrorEvent {` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3312 | `message: "WebSocket connection to 'ws://localhost:8279/?nodeId=node1' failed: Failed to connect",` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3313 | `error: null,` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3325 | `Failed to connect to node node3 (attempt 1): ErrorEvent {` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3327 | `message: "WebSocket connection to 'ws://localhost:8120/?nodeId=node1' failed: Failed to connect",` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3328 | `error: null,` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3331 | `Broadcast test failed: ErrorEvent {` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3333 | `message: "WebSocket connection to 'ws://localhost:8120/?nodeId=node1' failed: Failed to connect",` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3334 | `error: null,` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3346 | `Failed to connect to node node2 (attempt 1): ErrorEvent {` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3348 | `message: "WebSocket connection to 'ws://localhost:8119/?nodeId=node1' failed: Failed to connect",` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3349 | `error: null,` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3352 | `Failed to connect to node node2 (attempt 1): ErrorEvent {` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3354 | `message: "WebSocket connection to 'ws://localhost:8233/?nodeId=node1' failed: Failed to connect",` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3355 | `error: null,` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3358 | `Checksum test failed: ErrorEvent {` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3360 | `message: "WebSocket connection to 'ws://localhost:8233/?nodeId=node1' failed: Failed to connect",` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3361 | `error: null,` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3373 | `Retry failed for node node2: 199 |     }` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3380 | `error: NetworkManager is closed` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3385 | `Failed to connect to node node2 (attempt 1): ErrorEvent {` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3387 | `message: "WebSocket connection to 'ws://localhost:8570/?nodeId=node1' failed: Failed to connect",` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3388 | `error: null,` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3391 | `Connection tracking test failed: ErrorEvent {` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3393 | `message: "WebSocket connection to 'ws://localhost:8570/?nodeId=node1' failed: Failed to connect",` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3394 | `error: null,` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3406 | `Retry failed for node nonexistent: 199 |     }` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3413 | `error: NetworkManager is closed` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3418 | `Failed to connect to node node2 (attempt 1): ErrorEvent {` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3420 | `message: "WebSocket connection to 'ws://localhost:8106/?nodeId=node1' failed: Failed to connect",` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3421 | `error: null,` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3424 | `Disconnection test failed: ErrorEvent {` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3426 | `message: "WebSocket connection to 'ws://localhost:8106/?nodeId=node1' failed: Failed to connect",` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3427 | `error: null,` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3439 | `Retry failed for node node2: 199 |     }` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3446 | `error: NetworkManager is closed` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3451 | `Failed to connect to node node2 (attempt 1): ErrorEvent {` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3453 | `message: "WebSocket connection to 'ws://localhost:8527/?nodeId=node1' failed: Failed to connect",` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3454 | `error: null,` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3457 | `Event test failed: ErrorEvent {` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3459 | `message: "WebSocket connection to 'ws://localhost:8527/?nodeId=node1' failed: Failed to connect",` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3460 | `error: null,` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3472 | `Retry failed for node node3: 199 |     }` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3479 | `error: NetworkManager is closed` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3484 | `Retry failed for node node2: 199 |     }` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3491 | `error: NetworkManager is closed` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3506 | `Retry failed for node node2: 199 |     }` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3513 | `error: NetworkManager is closed` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3518 | `Failed to connect to node timeout-test (attempt 1): 115 |         this.#createWebSocket(url, protocols, headers, method);` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3525 | `SyntaxError: Invalid url for WebSocket ws://localhost:99998?nodeId=node1` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3544 | `Retry failed for node node2: 199 |     }` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3551 | `error: NetworkManager is closed` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3556 | `Failed to connect to node node2 (attempt 1): ErrorEvent {` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3558 | `message: "WebSocket connection to 'ws://localhost:8673/?nodeId=node1' failed: Failed to connect",` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3559 | `error: null,` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3562 | `Recovery test failed: ErrorEvent {` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3564 | `message: "WebSocket connection to 'ws://localhost:8673/?nodeId=node1' failed: Failed to connect",` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3565 | `error: null,` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3567 | `(pass) Replication Network Layer > Error Handling > should recover from connection failures [0.62ms]` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3577 | `Retry failed for node node2: 199 |     }` |

</details>

---

Теперь давайте найдем конкретные падающие тесты, ищем строки с "✗" или "fail":

---

<details>
            <summary>Grep search for "✗|^\s*\d+\)\s|error:|Error:|FAIL:|fail\s*$" • **2** files</summary>
        
| File | Line | Match |
|------|------|-------|
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L72 | `error: Test error` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3260 | `error: null,` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3266 | `error: null,` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3285 | `SyntaxError: Invalid url for WebSocket ws://localhost:99999?nodeId=node1` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3307 | `error: null,` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3313 | `error: null,` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3328 | `error: null,` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3334 | `error: null,` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3349 | `error: null,` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3355 | `error: null,` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3361 | `error: null,` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3380 | `error: NetworkManager is closed` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3388 | `error: null,` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3394 | `error: null,` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3413 | `error: NetworkManager is closed` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3421 | `error: null,` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3427 | `error: null,` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3446 | `error: NetworkManager is closed` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3454 | `error: null,` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3460 | `error: null,` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3479 | `error: NetworkManager is closed` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3491 | `error: NetworkManager is closed` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3513 | `error: NetworkManager is closed` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3525 | `SyntaxError: Invalid url for WebSocket ws://localhost:99998?nodeId=node1` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3551 | `error: NetworkManager is closed` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3559 | `error: null,` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3565 | `error: null,` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3584 | `error: NetworkManager is closed` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3592 | `error: null,` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3598 | `error: null,` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3618 | `error: NetworkManager is closed` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3626 | `error: null,` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3632 | `error: null,` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3664 | `error: NetworkManager is closed` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3677 | `error: NetworkManager is closed` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3689 | `error: NetworkManager is closed` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3701 | `error: NetworkManager is closed` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3714 | `error: NetworkManager is closed` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3976 | `error: Configuration file not found at: /Users/vedmalex/work/collection-store/packages/collection-store/test-data/config/valid.yml` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3987 | `error: Configuration file not found at: /Users/vedmalex/work/collection-store/packages/collection-store/test-data/config/valid.json` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3999 | `error: expect(received).toThrow(expected)` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L4013 | `error: expect(received).toThrow(expected)` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L4027 | `error: ENOENT: no such file or directory, copyfile '/Users/vedmalex/work/collection-store/packages/collection-store/test-data/config/valid.yml' -> '/Users/vedmalex/work/collection-store/packages/colle` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L4037 | `error: Configuration file not found at: /Users/vedmalex/work/collection-store/packages/collection-store/test-data/config/valid.yml` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L7606 | `error: Filter error` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L8423 | `error: Test error` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L8564 | `error: Transaction with id b7e01856-2fb9-4800-83e6-4ceeec800736 not found. Call prepareCommit first.` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L8640 | `Failed to generate thumbnail for size 100x100: UnsupportedFileTypeError: Unsupported file type: application/unsupported` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L8659 | `Failed to generate thumbnail for size 100x100: UnsupportedFileTypeError: Unsupported file type: application/octet-stream` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L9152 | `QueryOperatorError: $regex: $regex: Invalid regex flags specified: invalid (value: {"$regex":"test","$options":"invalid"})` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L9174 | `QueryOperatorError: $regex: $regex: $regex requires a string, RegExp, or { $regex, $options } object (value: 123)` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L9193 | `QueryOperatorError: $regex: $regex: $options requires a string (value: {"$regex":"test","$options":123})` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L9224 | `QueryOperatorError: $type: Invalid type name specified for $type: invalidtype (value: "invalidType")` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L9243 | `QueryOperatorError: $type: Invalid type name specified for $type: invalidtype (value: ["string","invalidType"])` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L9264 | `QueryOperatorError: $type: $type requires a type name string or an array of type name strings (value: {"invalid":true})` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L9289 | `QueryOperatorError: $mod: $mod divisor cannot be 0 (value: [0,1])` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L9309 | `QueryOperatorError: $mod: $mod requires divisor and remainder to be integers (value: [4,1.5])` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L9329 | `QueryOperatorError: $mod: $mod requires an array with [ divisor, remainder ] (value: [4])` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L9349 | `QueryOperatorError: $mod: $mod requires an array with [ divisor, remainder ] (value: "invalid")` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L9374 | `QueryOperatorError: $where: $where requires a string or function argument (value: 123)` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L9391 | `QueryOperatorError: $where: $where requires a string or function argument (value: null)` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L9409 | `QueryOperatorError: $where: Invalid $where JavaScript expression: Unexpected identifier 'syntax'. Expected ')' to end a compound expression. (value: "invalid syntax ===")` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L9436 | `QueryOperatorError: $text: $text requires an object with a $search property (value: {"$caseSensitive":false})` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L9457 | `QueryOperatorError: $text: $text operator requires $search to be a string (value: {"$search":123})` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L9478 | `QueryOperatorError: $text: $text operator $search string cannot be empty (value: {"$search":" "})` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L9499 | `QueryOperatorError: $text: $text operator $caseSensitive must be a boolean (value: {"$search":"test","$caseSensitive":"yes"})` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L9523 | `QueryOperatorError: $bitsAllSet: $bitsAllSet requires a non-negative integer bitmask or an array of non-negative bit positions (value: -1)` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L9541 | `QueryOperatorError: $bitsAllSet: $bitsAllSet requires a non-negative integer bitmask or an array of non-negative bit positions (value: 1.5)` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L9559 | `QueryOperatorError: $bitsAllSet: Bit positions must be non-negative integers in $bitsAllSet (value: [-1])` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L9579 | `QueryOperatorError: $bitsAllSet: $bitsAllSet requires a non-negative integer bitmask or an array of non-negative bit positions (value: "invalid")` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L9608 | `QueryOperatorError: $all: $all requires an array value (value: "invalid")` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L9626 | `QueryOperatorError: $all: $all requires an array value (value: null)` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L9647 | `QueryOperatorError: $size: $size requires a non-negative integer (value: -1)` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L9665 | `QueryOperatorError: $size: $size requires a non-negative integer (value: 1.5)` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L9683 | `QueryOperatorError: $size: $size requires a non-negative integer (value: "3")` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L9701 | `QueryOperatorError: $size: $size requires a non-negative integer (value: null)` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L9724 | `QueryOperatorError: $elemMatch: $elemMatch requires a query object (value: 123)` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L9742 | `QueryOperatorError: $elemMatch: $elemMatch requires a query object (value: null)` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L9760 | `QueryOperatorError: $elemMatch: $elemMatch requires a query object (value: [1,2])` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L9781 | `QueryOperatorError: $and: $and requires an array (value: {"key":"value"})` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L9800 | `QueryOperatorError: $or: $or requires an array (value: "value")` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L9817 | `QueryOperatorError: $in: $in requires an array (value: "active")` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L9836 | `QueryOperatorError: $unsupportedOp: Unsupported operator: $unsupportedOp (value: true)` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L10077 | `QueryOperatorError: $elemMatch: $elemMatch requires a query object (value: 123)` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L10095 | `QueryOperatorError: $elemMatch: $elemMatch requires a query object (value: null)` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L10113 | `QueryOperatorError: $elemMatch: $elemMatch requires a query object (value: [1,2])` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L10133 | `QueryOperatorError: $invalidOp: Unsupported operator: $invalidOp (value: 1)` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L12170 | `error: IndexedDB not supported in this environment` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L12188 | `error: IndexedDB not supported in this environment` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L12206 | `error: IndexedDB not supported in this environment` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L12224 | `error: IndexedDB not supported in this environment` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L12294 | `ComputedAttributeEngine internal error: {` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L12300 | `error: 295 |       context?: ErrorContext` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L12307 | `ComputedAttributeError: Attribute not found: non-existent` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L12325 | `error: 295 |       context?: ErrorContext` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L12332 | `ComputedAttributeError: Attribute not found: non-existent` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L12352 | `ComputedAttributeEngine internal error: {` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L12358 | `error: 295 |       context?: ErrorContext` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L12365 | `ComputedAttributeError: Computation failed: Error: Computation failed` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L72 | `error: Test error` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3260 | `error: null,` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3266 | `error: null,` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3285 | `SyntaxError: Invalid url for WebSocket ws://localhost:99999?nodeId=node1` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3307 | `error: null,` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3313 | `error: null,` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3328 | `error: null,` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3334 | `error: null,` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3349 | `error: null,` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3355 | `error: null,` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3361 | `error: null,` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3380 | `error: NetworkManager is closed` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3388 | `error: null,` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3394 | `error: null,` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3413 | `error: NetworkManager is closed` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3421 | `error: null,` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3427 | `error: null,` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3446 | `error: NetworkManager is closed` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3454 | `error: null,` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3460 | `error: null,` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3479 | `error: NetworkManager is closed` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3491 | `error: NetworkManager is closed` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3513 | `error: NetworkManager is closed` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3525 | `SyntaxError: Invalid url for WebSocket ws://localhost:99998?nodeId=node1` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3551 | `error: NetworkManager is closed` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3559 | `error: null,` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3565 | `error: null,` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3584 | `error: NetworkManager is closed` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3592 | `error: null,` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3598 | `error: null,` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3618 | `error: NetworkManager is closed` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3626 | `error: null,` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3632 | `error: null,` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3664 | `error: NetworkManager is closed` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3677 | `error: NetworkManager is closed` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3689 | `error: NetworkManager is closed` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3701 | `error: NetworkManager is closed` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3714 | `error: NetworkManager is closed` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3976 | `error: Configuration file not found at: /Users/vedmalex/work/collection-store/packages/collection-store/test-data/config/valid.yml` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3987 | `error: Configuration file not found at: /Users/vedmalex/work/collection-store/packages/collection-store/test-data/config/valid.json` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3999 | `error: expect(received).toThrow(expected)` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L4013 | `error: expect(received).toThrow(expected)` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L4027 | `error: ENOENT: no such file or directory, copyfile '/Users/vedmalex/work/collection-store/packages/collection-store/test-data/config/valid.yml' -> '/Users/vedmalex/work/collection-store/packages/colle` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L4037 | `error: Configuration file not found at: /Users/vedmalex/work/collection-store/packages/collection-store/test-data/config/valid.yml` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L7606 | `error: Filter error` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L8423 | `error: Test error` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L8564 | `error: Transaction with id b7e01856-2fb9-4800-83e6-4ceeec800736 not found. Call prepareCommit first.` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L8640 | `Failed to generate thumbnail for size 100x100: UnsupportedFileTypeError: Unsupported file type: application/unsupported` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L8659 | `Failed to generate thumbnail for size 100x100: UnsupportedFileTypeError: Unsupported file type: application/octet-stream` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L9152 | `QueryOperatorError: $regex: $regex: Invalid regex flags specified: invalid (value: {"$regex":"test","$options":"invalid"})` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L9174 | `QueryOperatorError: $regex: $regex: $regex requires a string, RegExp, or { $regex, $options } object (value: 123)` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L9193 | `QueryOperatorError: $regex: $regex: $options requires a string (value: {"$regex":"test","$options":123})` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L9224 | `QueryOperatorError: $type: Invalid type name specified for $type: invalidtype (value: "invalidType")` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L9243 | `QueryOperatorError: $type: Invalid type name specified for $type: invalidtype (value: ["string","invalidType"])` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L9264 | `QueryOperatorError: $type: $type requires a type name string or an array of type name strings (value: {"invalid":true})` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L9289 | `QueryOperatorError: $mod: $mod divisor cannot be 0 (value: [0,1])` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L9309 | `QueryOperatorError: $mod: $mod requires divisor and remainder to be integers (value: [4,1.5])` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L9329 | `QueryOperatorError: $mod: $mod requires an array with [ divisor, remainder ] (value: [4])` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L9349 | `QueryOperatorError: $mod: $mod requires an array with [ divisor, remainder ] (value: "invalid")` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L9374 | `QueryOperatorError: $where: $where requires a string or function argument (value: 123)` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L9391 | `QueryOperatorError: $where: $where requires a string or function argument (value: null)` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L9409 | `QueryOperatorError: $where: Invalid $where JavaScript expression: Unexpected identifier 'syntax'. Expected ')' to end a compound expression. (value: "invalid syntax ===")` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L9436 | `QueryOperatorError: $text: $text requires an object with a $search property (value: {"$caseSensitive":false})` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L9457 | `QueryOperatorError: $text: $text operator requires $search to be a string (value: {"$search":123})` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L9478 | `QueryOperatorError: $text: $text operator $search string cannot be empty (value: {"$search":" "})` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L9499 | `QueryOperatorError: $text: $text operator $caseSensitive must be a boolean (value: {"$search":"test","$caseSensitive":"yes"})` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L9523 | `QueryOperatorError: $bitsAllSet: $bitsAllSet requires a non-negative integer bitmask or an array of non-negative bit positions (value: -1)` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L9541 | `QueryOperatorError: $bitsAllSet: $bitsAllSet requires a non-negative integer bitmask or an array of non-negative bit positions (value: 1.5)` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L9559 | `QueryOperatorError: $bitsAllSet: Bit positions must be non-negative integers in $bitsAllSet (value: [-1])` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L9579 | `QueryOperatorError: $bitsAllSet: $bitsAllSet requires a non-negative integer bitmask or an array of non-negative bit positions (value: "invalid")` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L9608 | `QueryOperatorError: $all: $all requires an array value (value: "invalid")` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L9626 | `QueryOperatorError: $all: $all requires an array value (value: null)` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L9647 | `QueryOperatorError: $size: $size requires a non-negative integer (value: -1)` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L9665 | `QueryOperatorError: $size: $size requires a non-negative integer (value: 1.5)` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L9683 | `QueryOperatorError: $size: $size requires a non-negative integer (value: "3")` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L9701 | `QueryOperatorError: $size: $size requires a non-negative integer (value: null)` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L9724 | `QueryOperatorError: $elemMatch: $elemMatch requires a query object (value: 123)` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L9742 | `QueryOperatorError: $elemMatch: $elemMatch requires a query object (value: null)` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L9760 | `QueryOperatorError: $elemMatch: $elemMatch requires a query object (value: [1,2])` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L9781 | `QueryOperatorError: $and: $and requires an array (value: {"key":"value"})` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L9800 | `QueryOperatorError: $or: $or requires an array (value: "value")` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L9817 | `QueryOperatorError: $in: $in requires an array (value: "active")` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L9836 | `QueryOperatorError: $unsupportedOp: Unsupported operator: $unsupportedOp (value: true)` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L10077 | `QueryOperatorError: $elemMatch: $elemMatch requires a query object (value: 123)` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L10095 | `QueryOperatorError: $elemMatch: $elemMatch requires a query object (value: null)` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L10113 | `QueryOperatorError: $elemMatch: $elemMatch requires a query object (value: [1,2])` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L10133 | `QueryOperatorError: $invalidOp: Unsupported operator: $invalidOp (value: 1)` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L12170 | `error: IndexedDB not supported in this environment` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L12188 | `error: IndexedDB not supported in this environment` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L12206 | `error: IndexedDB not supported in this environment` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L12224 | `error: IndexedDB not supported in this environment` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L12294 | `ComputedAttributeEngine internal error: {` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L12300 | `error: 295 |       context?: ErrorContext` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L12307 | `ComputedAttributeError: Attribute not found: non-existent` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L12325 | `error: 295 |       context?: ErrorContext` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L12332 | `ComputedAttributeError: Attribute not found: non-existent` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L12352 | `ComputedAttributeEngine internal error: {` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L12358 | `error: 295 |       context?: ErrorContext` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L12365 | `ComputedAttributeError: Computation failed: Error: Computation failed` |

</details>

---

Теперь давайте найдем конкретные падающие тесты, ищем строки с номерами тестов и "✗":

---

<details>
            <summary>Grep search for "^\s*\d+\)\s" • **0** files</summary>
        
No results found
</details>

---

Давайте посмотрим на конец файла, где обычно выводится итоговая статистика тестов:

---

Read file: src/test_output.log

---

Теперь давайте посмотрим на самый конец файла, где должна быть итоговая статистика:

---

Read file: src/test_output.log

---

Отлично! Теперь я вижу, что у нас есть 7 падающих тестов. Давайте найдем детали этих падающих тестов:

---

<details>
            <summary>Grep search for "\(fail\)" • **2** files</summary>
        
| File | Line | Match |
|------|------|-------|
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3979 | `(fail) ConfigurationManager > loadFromFile > should load and validate a correct YAML configuration file [0.28ms]` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3990 | `(fail) ConfigurationManager > loadFromFile > should load and validate a correct JSON configuration file [0.04ms]` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L4005 | `(fail) ConfigurationManager > loadFromFile > should throw an error for a file with invalid syntax [0.53ms]` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L4019 | `(fail) ConfigurationManager > loadFromFile > should throw a validation error for a file with invalid structure [0.06ms]` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L4029 | `(fail) ConfigurationManager > loadFromFile > should throw an error for unsupported file formats [0.10ms]` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L4040 | `(fail) ConfigurationManager > getConfig > should return the loaded configuration` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L8568 | `(fail) AdapterMemory > should delete a record [0.17ms]` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L13759 | `(fail) ConfigurationManager > loadFromFile > should load and validate a correct YAML configuration file [0.28ms]` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L13760 | `(fail) ConfigurationManager > loadFromFile > should load and validate a correct JSON configuration file [0.04ms]` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L13761 | `(fail) ConfigurationManager > loadFromFile > should throw an error for a file with invalid syntax [0.53ms]` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L13762 | `(fail) ConfigurationManager > loadFromFile > should throw a validation error for a file with invalid structure [0.06ms]` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L13763 | `(fail) ConfigurationManager > loadFromFile > should throw an error for unsupported file formats [0.10ms]` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L13764 | `(fail) ConfigurationManager > getConfig > should return the loaded configuration` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L13765 | `(fail) AdapterMemory > should delete a record [0.17ms]` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3979 | `(fail) ConfigurationManager > loadFromFile > should load and validate a correct YAML configuration file [0.28ms]` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L3990 | `(fail) ConfigurationManager > loadFromFile > should load and validate a correct JSON configuration file [0.04ms]` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L4005 | `(fail) ConfigurationManager > loadFromFile > should throw an error for a file with invalid syntax [0.53ms]` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L4019 | `(fail) ConfigurationManager > loadFromFile > should throw a validation error for a file with invalid structure [0.06ms]` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L4029 | `(fail) ConfigurationManager > loadFromFile > should throw an error for unsupported file formats [0.10ms]` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L4040 | `(fail) ConfigurationManager > getConfig > should return the loaded configuration` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L8568 | `(fail) AdapterMemory > should delete a record [0.17ms]` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L13759 | `(fail) ConfigurationManager > loadFromFile > should load and validate a correct YAML configuration file [0.28ms]` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L13760 | `(fail) ConfigurationManager > loadFromFile > should load and validate a correct JSON configuration file [0.04ms]` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L13761 | `(fail) ConfigurationManager > loadFromFile > should throw an error for a file with invalid syntax [0.53ms]` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L13762 | `(fail) ConfigurationManager > loadFromFile > should throw a validation error for a file with invalid structure [0.06ms]` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L13763 | `(fail) ConfigurationManager > loadFromFile > should throw an error for unsupported file formats [0.10ms]` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L13764 | `(fail) ConfigurationManager > getConfig > should return the loaded configuration` |
| `file:///Users/vedmalex/work/collection-store/packages/collection-store/src/test_output.log` | L13765 | `(fail) AdapterMemory > should delete a record [0.17ms]` |

</details>

---

Теперь давайте найдем файлы тестов, которые содержат эти падающие тесты. Сначала найдем тесты ConfigurationManager:

---

<details>
            <summary>Searched codebase "ConfigurationManager.test" • **2** results</summary>
        
| File |
|------|
| `undefined` |
| `undefined` |

</details>

---

Теперь найдем тест AdapterMemory:

---

<details>
            <summary>Searched codebase "AdapterMemory.test" • **3** results</summary>
        
| File |
|------|
| `undefined` |
| `undefined` |
| `undefined` |

</details>

---

Давайте начнем с исправления первого падающего теста - ConfigurationManager. Сначала запустим этот тест, чтобы увидеть детали ошибки:

---

```bash
cd /Users/vedmalex/work/collection-store/packages/collection-store && bun test src/config/__test__/ConfigurationManager.test.ts
```

```
bun test v1.2.16 (631e6748)

src/config/__test__/ConfigurationManager.test.ts:
24 |    * @throws {Error} If the file is not found, cannot be parsed, or is inva
lid.
25 |    */
26 |   public static loadFromFile(filePath: string, enableHotReload: boolean = f
alse): CollectionStoreConfig
 {
                            27 |     const absolutePath = path.resolve(filePath)
;
28 |     if (!fs.existsSync(absolutePath)) {
29 |       throw new Error(`Configuration file not found at: ${absolutePath}`);
                                                                             ^
error: Configuration file not found at: /Users/vedmalex/work/collection-store/pa
ckages/collection-store/test
-data/config/valid.yml
                                  at loadFromFile (/Users/vedmalex/work/collecti
on-store/packages/collection-store/src/config/Configurat
ionManager.ts:29:73)
                                  at <anonymous> (/Users/vedmalex/work/collectio
n-store/packages/collection-store/src/config/__test__/Co
nfigurationManager.test.ts:21:43)
                            ✗ ConfigurationManager > loadFromFile > should load
and validate a correct YAML configuration file [3.59ms]
24 |    * @throws {Error} If the file is not found, cannot be parsed, or is inva
lid.
25 |    */
26 |   public static loadFromFile(filePath: string, enableHotReload: boolean = f
alse): CollectionStoreConfig
 {
                            27 |     const absolutePath = path.resolve(filePath)
;
28 |     if (!fs.existsSync(absolutePath)) {
29 |       throw new Error(`Configuration file not found at: ${absolutePath}`);
                                                                             ^
error: Configuration file not found at: /Users/vedmalex/work/collection-store/pa
ckages/collection-store/test
-data/config/valid.json
                                  at loadFromFile (/Users/vedmalex/work/collecti
on-store/packages/collection-store/src/config/Configurat
ionManager.ts:29:73)
                                  at <anonymous> (/Users/vedmalex/work/collectio
n-store/packages/collection-store/src/config/__test__/Co
nfigurationManager.test.ts:29:43)
                            ✗ ConfigurationManager > loadFromFile > should load
and validate a correct JSON configuration file [0.24ms]
✓ ConfigurationManager > loadFromFile > should throw an error if the file does n
ot exist [1.42ms]
39 |     });
40 | 
41 |     it('should throw an error for a file with invalid syntax', () => {
42 |       expect(() => {
43 |         ConfigurationManager.loadFromFile(invalidSyntaxPath);
44 |       }).toThrow(/Failed to parse configuration file/);
              ^
error: expect(received).toThrow(expected)

Expected pattern: /Failed to parse configuration file/
Received message: "Configuration file not found at: /Users/vedmalex/work/collect
ion-store/packages/collectio
n-store/test-data/config/invalid-syntax.yml"
                            
      at <anonymous> (/Users/vedmalex/work/collection-store/packages/collection-
store/src/config/__test__/Co
nfigurationManager.test.ts:44:10)
                            ✗ ConfigurationManager > loadFromFile > should throw
 an error for a file with invalid syntax [0.98ms]
45 |     });
46 | 
47 |     it('should throw a validation error for a file with invalid structure',
 () => {
48 |       expect(() => {
49 |         ConfigurationManager.loadFromFile(invalidStructurePath);
50 |       }).toThrow(/Configuration validation failed/);
              ^
error: expect(received).toThrow(expected)

Expected pattern: /Configuration validation failed/
Received message: "Configuration file not found at: /Users/vedmalex/work/collect
ion-store/packages/collectio
n-store/test-data/config/invalid-structure.yml"
                            
      at <anonymous> (/Users/vedmalex/work/collection-store/packages/collection-
store/src/config/__test__/Co
nfigurationManager.test.ts:50:10)
                            ✗ ConfigurationManager > loadFromFile > should throw
 a validation error for a file with invalid structure [0
.07ms]
                            50 |       }).toThrow(/Configuration validation fail
ed/);
51 |     });
52 | 
53 |     it('should throw an error for unsupported file formats', () => {
54 |       const unsupportedPath = path.join(import.meta.dir, '../../../test-dat
a/config/valid.yml').replace
('.yml', '.txt');
                            55 |       require('fs').copyFileSync(validYamlPath,
 unsupportedPath);
                         ^
error: ENOENT: no such file or directory, copyfile '/Users/vedmalex/work/collect
ion-store/packages/collectio
n-store/test-data/config/valid.yml' -> '/Users/vedmalex/work/collection-store/pa
ckages/collection-store/test-data/config/valid.txt'
                                                              at <anonymous> (/U
sers/vedmalex/work/collection-store/packages/collection-store/src/config/__test_
_/Co
nfigurationManager.test.ts:55:21)
                            ✗ ConfigurationManager > loadFromFile > should throw
 an error for unsupported file formats [1.53ms]
24 |    * @throws {Error} If the file is not found, cannot be parsed, or is inva
lid.
25 |    */
26 |   public static loadFromFile(filePath: string, enableHotReload: boolean = f
alse): CollectionStoreConfig
 {
                            27 |     const absolutePath = path.resolve(filePath)
;
28 |     if (!fs.existsSync(absolutePath)) {
29 |       throw new Error(`Configuration file not found at: ${absolutePath}`);
                                                                             ^
error: Configuration file not found at: /Users/vedmalex/work/collection-store/pa
ckages/collection-store/test
-data/config/valid.yml
                                  at loadFromFile (/Users/vedmalex/work/collecti
on-store/packages/collection-store/src/config/Configurat
ionManager.ts:29:73)
                                  at <anonymous> (/Users/vedmalex/work/collectio
n-store/packages/collection-store/src/config/__test__/Co
nfigurationManager.test.ts:67:28)
                            ✗ ConfigurationManager > getConfig > should return t
he loaded configuration [0.07ms]
✓ ConfigurationManager > getConfig > should throw an error if getConfig is calle
d before loadFromFile [0.04m
s]
                            
 2 pass
 6 fail
 4 expect() calls
Ran 8 tests across 1 files. [150.00ms]

```

---

Проблема в том, что отсутствуют тестовые файлы конфигурации. Давайте посмотрим на структуру тестов и создадим недостающие файлы:

---

Read file: src/config/__test__/ConfigurationManager.test.ts

---

Теперь давайте проверим, существует ли директория test-data:

---

<details>
            <summary>Listed directory test-data • **1** results</summary>
        
| Name |
|-------|
| 📁 `replication-wal` |

</details>

---

Директория существует, но нет папки config. Давайте создадим необходимые тестовые файлы:

---

```bash
mkdir -p test-data/config
```

```
?➜  collection-store git:(master) ?✗ 

```

---

Теперь давайте посмотрим на структуру конфигурации, чтобы создать правильные тестовые файлы:

---

Read file: src/config/ConfigurationManager.ts

---

Теперь давайте посмотрим на схему конфигурации:

---

Read file: src/config/schemas/CollectionStoreConfig.ts

---

Теперь давайте посмотрим на другие схемы, чтобы понять полную структуру:

---

Read file: src/config/schemas/AdapterConfig.ts

---

Теперь давайте посмотрим на схемы функций:

---

Read file: src/config/schemas/FeatureConfig.ts

---

Теперь давайте посмотрим на схему окружения:

---

Read file: src/config/schemas/EnvironmentConfig.ts

---

Теперь у меня есть полное понимание структуры конфигурации. Давайте создадим необходимые тестовые файлы:

---

```diff
- 
+ core:
+   name: test-store
+   version: 1.0.0
+   environment: development
+   nodeId: test-node-1
+   clusterId: test-cluster
+ 
+ adapters:
+   file:
+     type: markdown
+     enabled: true
+     priority: 1
+     role: primary
+     config:
+       basePath: ./data
+       filePattern: "**/*.md"
+       encoding: utf8
+ 
+ features:
+   replication:
+     enabled: false
+   realtime:
+     enabled: false
+   offline:
+     enabled: false
+   analytics:
+     enabled: false
+ 
+ indexManager:
+   enabled: true
+   btreeOptions:
+     degree: 3
+     unique: false
+   performance:
+     cacheSize: 1000
+     enableProfiling: false
+     slowQueryThreshold: 100
+   transactions:
+     enabled: true
+     timeout: 5000
+     maxConcurrent: 100
```

---

```diff
- 
+ {
+   "core": {
+     "name": "test-store-json",
+     "version": "1.0.0",
+     "environment": "production",
+     "nodeId": "test-node-json",
+     "clusterId": "test-cluster-json"
+   },
+   "adapters": {
+     "file": {
+       "type": "markdown",
+       "enabled": true,
+       "priority": 1,
+       "role": "primary",
+       "config": {
+         "basePath": "./data",
+         "filePattern": "**/*.md",
+         "encoding": "utf8"
+       }
+     }
+   },
+   "features": {
+     "replication": {
+       "enabled": false
+     },
+     "realtime": {
+       "enabled": false
+     },
+     "offline": {
+       "enabled": false
+     },
+     "analytics": {
+       "enabled": false
+     }
+   },
+   "indexManager": {
+     "enabled": true,
+     "btreeOptions": {
+       "degree": 3,
+       "unique": false
+     },
+     "performance": {
+       "cacheSize": 1000,
+       "enableProfiling": false,
+       "slowQueryThreshold": 100
+     },
+     "transactions": {
+       "enabled": true,
+       "timeout": 5000,
+       "maxConcurrent": 100
+     }
+   }
+ }
```

---

```diff
- 
+ core:
+   name: test-store
+   version: 1.0.0
+   environment: development
+   invalid_yaml_syntax: [
+     - item1
+     - item2
+   # Missing closing bracket
+ adapters:
+   file:
+     type: markdown
```

---

```diff
- 
+ core:
+   name: test-store
+   version: 1.0.0
+   environment: invalid_environment  # Invalid environment value
+ 
+ adapters:
+   file:
+     type: invalid_type  # Invalid adapter type
+     enabled: "not_boolean"  # Should be boolean
+     priority: "not_number"  # Should be number
+     role: invalid_role  # Invalid role
+ 
+ features:
+   replication:
+     enabled: "not_boolean"  # Should be boolean
+   realtime:
+     enabled: false
+   offline:
+     enabled: false
+   analytics:
+     enabled: false
```

---

Теперь давайте запустим тест ConfigurationManager снова, чтобы проверить, исправились ли проблемы:

---

```bash
bun test src/config/__test__/ConfigurationManager.test.ts
```

```
?➜  collection-store git:(master) ?✗ bun test src/config/__test__/ConfigurationManager.test.ts
bun test v1.2.16 (631e6748)

src/config/__test__/ConfigurationManager.test.ts:
✓ ConfigurationManager > loadFromFile > should load and validate a correct YAML configuration file [6.65ms]
✓ ConfigurationManager > loadFromFile > should load and validate a correct JSON configuration file [0.86ms]
✓ ConfigurationManager > loadFromFile > should throw an error if the file does not exist [0.10ms]
✓ ConfigurationManager > loadFromFile > should throw an error for a file with invalid syntax [1.90ms]
✓ ConfigurationManager > loadFromFile > should throw a validation error for a file with invalid structure [2
.32ms]
✓ ConfigurationManager > loadFromFile > should throw an error for unsupported file formats [1.18ms]
✓ ConfigurationManager > getConfig > should return the loaded configuration [0.57ms]
✓ ConfigurationManager > getConfig > should throw an error if getConfig is called before loadFromFile [0.05m
s]

 8 pass
 0 fail
 14 expect() calls
Ran 8 tests across 1 files. [77.00ms]
➜  collection-store git:(master) ✗
```

---

Отлично! Тесты ConfigurationManager теперь проходят. Теперь давайте исправим второй падающий тест - AdapterMemory. Сначала запустим его, чтобы увидеть ошибку:

---

```bash
bun test src/storage/__test__/AdapterMemory.test.ts
```

```
➜  collection-store git:(master) ✗ bun test src/storage/__test__/AdapterMemory.test.ts
bun test v1.2.16 (631e6748)

src/storage/__test__/AdapterMemory.test.ts:
✓ AdapterMemory > should create and read a record [2.94ms]
✓ AdapterMemory > should return null when reading a non-existent record
✓ AdapterMemory > should update a record [0.10ms]
✓ AdapterMemory > should not throw when updating a non-existent record [0.24ms]
68 |       internalTxId = tmTxIdOrId;
69 |     }
70 | 
71 |     if (tmTxIdOrId && !internalTxId) {
72 |       // If a tmTxId was provided but no internalTxId was resolved, it means prepareCommit wasn't calle
d.
73 |       throw new Error(`Transaction with id ${tmTxIdOrId} not found. Call prepareCommit first.`);
                 ^
error: Transaction with id 89b39721-6845-42af-b079-a9b344b4d36f not found. Call prepareCommit first.
      at delete (/Users/vedmalex/work/collection-store/packages/collection-store/src/storage/AdapterMemory.t
s:73:13)
      at delete (/Users/vedmalex/work/collection-store/packages/collection-store/src/storage/AdapterMemory.t
s:55:16)
      at <anonymous> (/Users/vedmalex/work/collection-store/packages/collection-store/src/storage/__test__/A
dapterMemory.test.ts:48:19)
✗ AdapterMemory > should delete a record [1.63ms]
✓ AdapterMemory > should find records matching a query [0.92ms]
✓ AdapterMemory > should return an empty array if no records match a query [0.05ms]
✓ AdapterMemory > should return an empty array if the collection does not exist [0.03ms]
✓ AdapterMemory > should clear all data on close [0.05ms]

 8 pass
 1 fail
 13 expect() calls
Ran 9 tests across 1 files. [42.00ms]
➜  collection-store git:(master) ✗
```

---

Проблема в тесте удаления записи. Давайте посмотрим на тест и код AdapterMemory:

---

Read file: src/storage/__test__/AdapterMemory.test.ts

---

Теперь давайте посмотрим на код AdapterMemory, особенно на метод delete:

---

Read file: src/storage/AdapterMemory.ts

---

Проблема в том, что метод `delete` в AdapterMemory ожидает, что для транзакций сначала будет вызван `prepareCommit`, но в тесте мы вызываем `delete` напрямую без транзакции. Давайте посмотрим на сигнатуру метода delete более внимательно:

---

Read file: src/storage/AdapterMemory.ts

---



Проблема в том, что метод `delete` имеет двойную логику: он может работать как с key-value парами, так и с коллекциями. Но логика определения того, что второй параметр является ID документа, а не ID транзакции, неправильная. 

Давайте посмотрим на интерфейс, который должен реализовывать AdapterMemory:

---

<details>
            <summary>Searched codebase "IStorageAdapter" • **3** results</summary>
        
| File |
|------|
| `undefined` |
| `undefined` |
| `undefined` |

</details>

---

Read file: src/types/IStorageAdapter.ts

---

Это не тот интерфейс. Давайте посмотрим на другой:

---

Read file: src/storage/IGenericStorageAdapter.ts

---

Теперь я вижу проблему! В интерфейсе метод `delete` имеет сигнатуру `delete(key: string, txId?: string): Promise<void>`, но в тесте мы вызываем его как `delete(collection, id)` для удаления документа из коллекции.

Проблема в том, что AdapterMemory пытается поддерживать два разных API:
1. Key-value API: `delete(key, txId?)`
2. Collection API: `delete(collection, id)`

Но логика определения того, что это за вызов, неправильная. Давайте исправим это. Нужно добавить отдельный метод для удаления из коллекций или изменить логику определения:

---

Read file: src/storage/AdapterMemory.ts

---

Проблема в том, что логика в методе `delete` неправильно определяет, является ли второй параметр ID транзакции или ID документа. Нужно добавить отдельный метод для удаления документов из коллекций или изменить логику.

Давайте добавим отдельный метод `deleteFromCollection`:

---



---

Теперь давайте запустим тест AdapterMemory снова, чтобы проверить, исправилась ли проблема:

---

```bash
bun test src/storage/__test__/AdapterMemory.test.ts
```

```
➜  collection-store git:(master) ✗ bun test src/storage/__test__/AdapterMemory.test.ts
bun test v1.2.16 (631e6748)

src/storage/__test__/AdapterMemory.test.ts:
✓ AdapterMemory > should create and read a record [3.33ms]
✓ AdapterMemory > should return null when reading a non-existent record [0.20ms]
✓ AdapterMemory > should update a record [0.25ms]
✓ AdapterMemory > should not throw when updating a non-existent record [0.21ms]
✓ AdapterMemory > should delete a record [0.42ms]
✓ AdapterMemory > should find records matching a query [3.68ms]
✓ AdapterMemory > should return an empty array if no records match a query [0.45ms]
✓ AdapterMemory > should return an empty array if the collection does not exist [0.07ms]
✓ AdapterMemory > should clear all data on close [0.08ms]

 9 pass
 0 fail
 14 expect() calls
Ran 9 tests across 1 files. [47.00ms]
➜  collection-store git:(master) ✗
```

---

Отлично! Теперь все тесты AdapterMemory проходят. Давайте запустим все тесты снова, чтобы убедиться, что мы исправили все падающие тесты:

---

```bash
bun test 2>&1 | tail -20
```

```
➜  collection-store git:(master) ✗ bun test 2>&1 | tail -20
```

---

_**User**_

я проверил, все тесты выполнены успешно

---

_**Assistant**_

Отлично! Мы успешно исправили все падающие тесты. Давайте подведем итоги того, что было сделано:

## 📊 Результаты исправления тестов

### ✅ Исправленные проблемы:

**1. ConfigurationManager тесты (6 падающих тестов)**
- **Проблема**: Отсутствовали тестовые файлы конфигурации
- **Решение**: Создали необходимые тестовые файлы:
  - `test-data/config/valid.yml` - валидная YAML конфигурация
  - `test-data/config/valid.json` - валидная JSON конфигурация  
  - `test-data/config/invalid-syntax.yml` - файл с невалидным YAML синтаксисом
  - `test-data/config/invalid-structure.yml` - файл с невалидной структурой конфигурации

**2. AdapterMemory тест (1 падающий тест)**
- **Проблема**: Неправильная логика в методе `delete()` - он не мог различить вызов для удаления документа из коллекции от вызова с ID транзакции
- **Решение**: Улучшили логику определения типа операции в методе `delete()`:
  - Сначала проверяем, является ли это операцией с коллекцией
  - Затем проверяем, является ли это транзакционной операцией
  - В конце обрабатываем как key-value операцию

### 📈 Итоговая статистика:
- **Было**: 7 падающих тестов
- **Стало**: 0 падающих тестов
- **Исправлено**: 100% падающих тестов

### 🔧 Файлы, которые были изменены:
1. `test-data/config/valid.yml` - создан
2. `test-data/config/valid.json` - создан  
3. `test-data/config/invalid-syntax.yml` - создан
4. `test-data/config/invalid-structure.yml` - создан
5. `src/storage/AdapterMemory.ts` - исправлена логика метода `delete()`

Все тесты теперь проходят успешно! Система готова к дальнейшей разработке.

---
*Response generated using Claude Sonnet 4*

---

